<!-- 
    Main Habit Tracker Page (EJS Template)
    This is the main view that displays the habit tracker interface
-->
<%- include('partials/header') %>

<!-- Navigation Bar -->
<nav class="navbar">
    <div class="nav-brand">
        <div class="profile-icon-container" onclick="switchPage('page-profile')">
            <div class="profile-icon" id="nav-profile-icon">
                <span class="profile-icon-text"></span>
            </div>
        </div>
        <h1>ğŸ“Š Habit Tracker</h1>
    </div>
    <ul class="nav-menu">
        <li class="nav-item"><a href="#" class="nav-link active" data-page="page-add-habit">â• Add Habit</a></li>
        <li class="nav-item"><a href="#" class="nav-link" data-page="page-all-habits">ğŸ“‹ All Habits</a></li>
        <li class="nav-item"><a href="#" class="nav-link" data-page="page-analytics">ğŸ“ˆ Analytics</a></li>
        <li class="nav-item"><a href="#" class="nav-link" data-page="page-weekly-progress">ğŸ“… Weekly Progress</a></li>
        <li class="nav-item user-menu">
            <span class="user-name"><%= userName %></span>
            <a href="/logout" class="btn-logout">Logout</a>
        </li>
    </ul>
</nav>

<!-- Main container for the habit tracker app -->
<div class="container">
    
    <!-- PAGE 1: Add New Habit -->
    <div id="page-add-habit" class="page active">
        <header>
            <h1>Add New Habit</h1>
            <p class="subtitle">Create a new habit to track daily</p>
        </header>

        <section class="add-habit-section">
            <form id="habit-form">
                <div class="form-group">
                    <label for="habit-input">Habit Name</label>
                    <input 
                        type="text" 
                        id="habit-input" 
                        placeholder="e.g., Drink 8 glasses of water"
                        required
                    >
                </div>
                <div class="form-group">
                    <label for="habit-description">Description (Optional)</label>
                    <input 
                        type="text" 
                        id="habit-description" 
                        placeholder="e.g., Stay hydrated throughout the day"
                    >
                </div>
                <div class="form-group">
                    <label for="habit-category">Category</label>
                    <select id="habit-category">
                        <option value="health">ğŸƒ Health</option>
                        <option value="productivity">ğŸ’¼ Productivity</option>
                        <option value="learning">ğŸ“š Learning</option>
                        <option value="mindfulness">ğŸ§˜ Mindfulness</option>
                        <option value="social">ğŸ‘¥ Social</option>
                        <option value="other">âœï¸ Other</option>
                    </select>
                </div>
                <div class="form-group" id="custom-category-group" style="display: none;">
                    <label for="custom-category-input">Custom Category</label>
                    <input 
                        type="text" 
                        id="custom-category-input" 
                        placeholder="e.g., Finance, Hobbies, etc."
                    >
                </div>
                <div class="form-group">
                    <label>How many days would you like to skip per week?</label>
                    <small class="form-help">Select one option that fits your schedule</small>
                    <div class="skip-days-table">
                        <label class="skip-option">
                            <input type="radio" name="skip-days" value="0" checked>
                            <div class="skip-option-content">
                                <div class="skip-icon">ğŸ”¥</div>
                                <div class="skip-label">No Skip Days</div>
                                <div class="skip-description">7 days active</div>
                                <div class="skip-detail">Daily commitment</div>
                            </div>
                        </label>
                        <label class="skip-option">
                            <input type="radio" name="skip-days" value="1">
                            <div class="skip-option-content">
                                <div class="skip-icon">ğŸ’ª</div>
                                <div class="skip-label">1 Skip Day</div>
                                <div class="skip-description">6 days active</div>
                                <div class="skip-detail">1 rest day</div>
                            </div>
                        </label>
                        <label class="skip-option">
                            <input type="radio" name="skip-days" value="2">
                            <div class="skip-option-content">
                                <div class="skip-icon">â­</div>
                                <div class="skip-label">2 Skip Days</div>
                                <div class="skip-description">5 days active</div>
                                <div class="skip-detail">2 rest days</div>
                            </div>
                        </label>
                        <label class="skip-option">
                            <input type="radio" name="skip-days" value="3">
                            <div class="skip-option-content">
                                <div class="skip-icon">ğŸ¯</div>
                                <div class="skip-label">3 Skip Days</div>
                                <div class="skip-description">4 days active</div>
                                <div class="skip-detail">3 rest days</div>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="form-group" id="specific-days-group" style="display: none;">
                    <label>Which specific days would you like to skip?</label>
                    <small class="form-help" id="skip-days-help">Select the days you want to take as rest days</small>
                    <div class="days-checkbox-table">
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="monday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Monday</div>
                                <div class="day-icon">ğŸ“…</div>
                            </div>
                        </label>
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="tuesday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Tuesday</div>
                                <div class="day-icon">ğŸ“…</div>
                            </div>
                        </label>
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="wednesday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Wednesday</div>
                                <div class="day-icon">ğŸ“…</div>
                            </div>
                        </label>
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="thursday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Thursday</div>
                                <div class="day-icon">ğŸ“…</div>
                            </div>
                        </label>
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="friday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Friday</div>
                                <div class="day-icon">ğŸ“…</div>
                            </div>
                        </label>
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="saturday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Saturday</div>
                                <div class="day-icon">ğŸ–ï¸</div>
                            </div>
                        </label>
                        <label class="day-checkbox">
                            <input type="checkbox" name="skip-specific-days" value="sunday">
                            <div class="day-checkbox-content">
                                <div class="day-name">Sunday</div>
                                <div class="day-icon">â˜€ï¸</div>
                            </div>
                        </label>
                    </div>
                    <div class="selected-days-preview" id="selected-days-preview" style="display: none;">
                        <strong>Rest days:</strong> <span id="selected-days-list"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="minimum-duration">Minimum Duration (Optional)</label>
                    <small class="form-help">Set a minimum time requirement in minutes (leave blank for no time limit)</small>
                    <input 
                        type="number" 
                        id="minimum-duration" 
                        placeholder="e.g., 30 (minutes)"
                        min="1"
                        max="480"
                    >
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="accountability-mode" name="accountabilityMode">
                        <span>Enable Accountability Mode (Optional)</span>
                    </label>
                    <small class="form-help">When enabled, you'll be required to provide extra proof (image or detailed note) before completing this habit. This helps maintain higher accountability.</small>
                </div>
                <button type="submit" class="btn-primary">Create Habit</button>
            </form>
        </section>

        <!-- Quick Stats Preview -->
        <section class="quick-stats">
            <h3>Your Quick Stats</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-habits">0</div>
                    <div class="stat-label">Total Habits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="active-today">0</div>
                    <div class="stat-label">Completed Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="longest-streak">0</div>
                    <div class="stat-label">Longest Streak</div>
                </div>
            </div>
        </section>
    </div>

    <!-- PAGE 2: All Habits View -->
    <div id="page-all-habits" class="page">
        <header>
            <h1>All Habits</h1>
            <p class="subtitle">Manage and track your daily habits</p>
        </header>

        <section class="habits-section">
            <div id="habits-container" class="habit-list">
                <p class="loading-text">Loading habits...</p>
            </div>
        </section>
    </div>

    <!-- PAGE 3: Daily Analytics -->
    <div id="page-analytics" class="page">
        <header>
            <h1>Daily Analytics</h1>
            <p class="subtitle">Track your progress across all habits</p>
        </header>

        <section class="analytics-section">
            <!-- Weekly Overview Chart - All Habits Combined -->
            <div class="chart-container chart-featured">
                <h3>ğŸ“Š Weekly Overview - All Habits</h3>
                <p class="chart-subtitle">Daily completion status for all habits combined this week</p>
                <canvas id="weeklyOverviewChart"></canvas>
            </div>

            <!-- Daily Completion Chart -->
            <div class="chart-container">
                <h3>Daily Completion Rate</h3>
                <canvas id="dailyCompletionChart"></canvas>
            </div>

            <!-- Daily Status Breakdown -->
            <div class="chart-container">
                <h3>Today's Status</h3>
                <div class="status-breakdown">
                    <div class="status-item completed-status">
                        <div class="status-icon">âœ“</div>
                        <div class="status-info">
                            <div class="status-count" id="completed-count">0</div>
                            <div class="status-label">Completed</div>
                            <div class="status-percentage" id="completed-percentage">0%</div>
                        </div>
                    </div>
                    <div class="status-item skipped-status">
                        <div class="status-icon">âŠ˜</div>
                        <div class="status-info">
                            <div class="status-count" id="skipped-count">0</div>
                            <div class="status-label">Skipped</div>
                            <div class="status-percentage" id="skipped-percentage">0%</div>
                        </div>
                    </div>
                    <div class="status-item notdone-status">
                        <div class="status-icon">â—‹</div>
                        <div class="status-info">
                            <div class="status-count" id="notdone-count">0</div>
                            <div class="status-label">Not Done</div>
                            <div class="status-percentage" id="notdone-percentage">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Breakdown Chart -->
            <div class="chart-container">
                <h3>Completion by Category</h3>
                <canvas id="categoryChart"></canvas>
            </div>
        </section>
    </div>

    <!-- PAGE 4: Weekly Progress -->
    <div id="page-weekly-progress" class="page">
        <header>
            <h1>Weekly Progress</h1>
            <p class="subtitle">Detailed weekly analysis for each habit</p>
        </header>

        <!-- Color Legend -->
        <div class="progress-legend">
            <div class="legend-item">
                <span class="legend-dot completed"></span>
                <span class="legend-label">Completed</span>
            </div>
            <div class="legend-item">
                <span class="legend-dot skipped"></span>
                <span class="legend-label">Skipped</span>
            </div>
            <div class="legend-item">
                <span class="legend-dot missed"></span>
                <span class="legend-label">Missed</span>
            </div>
        </div>

        <section class="weekly-analysis-section">
            <div id="weekly-progress-container">
                <p class="loading-text">Loading weekly progress...</p>
            </div>
        </section>
    </div>

    <!-- PAGE 5: User Profile -->
    <div id="page-profile" class="page">
        <header>
            <h1>My Profile</h1>
            <p class="subtitle" id="profile-subtitle">View and edit your account information</p>
        </header>

        <section class="profile-section">
            <div class="profile-container">
                <div class="profile-loading">
                    <p>Loading profile...</p>
                </div>
                
                <div class="profile-content" style="display: none;">
                    <!-- View Mode -->
                    <div id="profile-view-mode">
                        <div class="profile-header">
                            <div class="profile-avatar-wrapper">
                                <div class="profile-avatar" id="profile-avatar">
                                    <span class="avatar-text"></span>
                                </div>
                                <button class="btn-edit-avatar" id="btn-edit-mode" onclick="enterEditMode()">
                                    âœï¸ Edit Profile
                                </button>
                            </div>
                            <div class="profile-info">
                                <h2 id="profile-name">Loading...</h2>
                                <p class="profile-email" id="profile-email"></p>
                                <p class="profile-about" id="profile-about"></p>
                            </div>
                        </div>

                        <!-- Profile Statistics -->
                        <div class="profile-stats-grid">
                            <div class="stat-card stat-card-primary">
                                <div class="stat-icon">ğŸ“</div>
                                <div class="stat-content">
                                    <div class="stat-label">Total Habits</div>
                                    <div class="stat-value" id="stat-total-habits">0</div>
                                    <div class="stat-subtext">Active habits tracked</div>
                                </div>
                            </div>
                            
                            <div class="stat-card stat-card-success">
                                <div class="stat-icon">âœ…</div>
                                <div class="stat-content">
                                    <div class="stat-label">Completed Today</div>
                                    <div class="stat-value" id="stat-completed-today">0</div>
                                    <div class="stat-subtext">habits done today</div>
                                </div>
                            </div>
                            
                            <div class="stat-card stat-card-fire">
                                <div class="stat-icon">ğŸ”¥</div>
                                <div class="stat-content">
                                    <div class="stat-label">Current Streak</div>
                                    <div class="stat-value" id="stat-current-streak">0</div>
                                    <div class="stat-subtext">days in a row</div>
                                </div>
                            </div>
                            
                            <div class="stat-card stat-card-trophy">
                                <div class="stat-icon">ğŸ†</div>
                                <div class="stat-content">
                                    <div class="stat-label">Best Streak</div>
                                    <div class="stat-value" id="stat-best-streak">0</div>
                                    <div class="stat-subtext">longest streak</div>
                                </div>
                            </div>

                            <div class="stat-card stat-card-info">
                                <div class="stat-icon">ğŸ“Š</div>
                                <div class="stat-content">
                                    <div class="stat-label">Weekly Completion</div>
                                    <div class="stat-value" id="stat-weekly-completion">0%</div>
                                    <div class="stat-subtext">this week's progress</div>
                                </div>
                            </div>

                            <div class="stat-card stat-card-warning">
                                <div class="stat-icon">â°</div>
                                <div class="stat-content">
                                    <div class="stat-label">Days Active</div>
                                    <div class="stat-value" id="stat-days-active">0</div>
                                    <div class="stat-subtext">since joining</div>
                                </div>
                            </div>
                        </div>

                        <!-- Account Details -->
                        <div class="profile-details">
                            <div class="detail-card">
                                <div class="detail-icon">ğŸ†”</div>
                                <div class="detail-content">
                                    <label>User ID</label>
                                    <div class="detail-value">
                                        <span id="profile-userId">Loading...</span>
                                        <button class="btn-copy" onclick="copyToClipboard('profile-userId')" title="Copy User ID">
                                            ğŸ“‹
                                        </button>
                                    </div>
                                    <small class="detail-help">Use this ID for login</small>
                                </div>
                            </div>

                            <div class="detail-card">
                                <div class="detail-icon">ğŸ”</div>
                                <div class="detail-content">
                                    <label>Authentication Method</label>
                                    <div class="detail-value" id="profile-authProvider">Loading...</div>
                                </div>
                            </div>

                            <div class="detail-card">
                                <div class="detail-icon">ğŸ“…</div>
                                <div class="detail-content">
                                    <label>Member Since</label>
                                    <div class="detail-value" id="profile-createdAt">Loading...</div>
                                </div>
                            </div>
                        </div>

                        <!-- Badge Collection Section -->
                        <div class="badges-section">
                            <h3 class="section-title">ğŸ† Streak Badges</h3>
                            <p class="section-subtitle">Earn badges by maintaining consistent habit streaks</p>
                            <div class="badges-container" id="badges-container">
                                <!-- Badges will be dynamically generated -->
                            </div>
                        </div>

                        <!-- Achievements Section -->
                        <div class="achievements-section">
                            <h3 class="section-title">ğŸ… Achievements</h3>
                            <div class="achievements-grid" id="achievements-grid">
                                <div class="achievement-card achievement-locked">
                                    <div class="achievement-icon">ğŸŒ±</div>
                                    <div class="achievement-name">First Habit</div>
                                    <div class="achievement-desc">Create your first habit</div>
                                </div>
                                <div class="achievement-card achievement-locked">
                                    <div class="achievement-icon">âš¡</div>
                                    <div class="achievement-name">Streak Master</div>
                                    <div class="achievement-desc">Maintain a 7-day streak</div>
                                </div>
                                <div class="achievement-card achievement-locked">
                                    <div class="achievement-icon">ğŸ’ª</div>
                                    <div class="achievement-name">Dedicated</div>
                                    <div class="achievement-desc">Complete 30 habits</div>
                                </div>
                                <div class="achievement-card achievement-locked">
                                    <div class="achievement-icon">ğŸ¯</div>
                                    <div class="achievement-name">Perfect Week</div>
                                    <div class="achievement-desc">Complete all habits for a week</div>
                                </div>
                                <div class="achievement-card achievement-locked">
                                    <div class="achievement-icon">ğŸ”¥</div>
                                    <div class="achievement-name">On Fire!</div>
                                    <div class="achievement-desc">30-day streak achieved</div>
                                </div>
                                <div class="achievement-card achievement-locked">
                                    <div class="achievement-icon">ğŸ‘‘</div>
                                    <div class="achievement-name">Habit King</div>
                                    <div class="achievement-desc">Track 10+ habits</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Mode -->
                    <div id="profile-edit-mode" style="display: none;">
                        <form id="profile-edit-form">
                            <div class="profile-header">
                                <div class="profile-avatar-wrapper">
                                    <div class="profile-avatar" id="profile-avatar-edit">
                                        <span class="avatar-text-edit"></span>
                                    </div>
                                    <div class="avatar-upload">
                                        <input type="url" id="photoURL-input" placeholder="Paste image URL (optional)" class="url-input">
                                        <small class="form-help">Enter a direct image URL or leave blank for default icon</small>
                                    </div>
                                </div>
                                <div class="profile-info">
                                    <div class="form-group">
                                        <label for="name-input">Display Name</label>
                                        <input type="text" id="name-input" maxlength="100" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="about-input">About Me</label>
                                        <textarea id="about-input" rows="4" maxlength="500" placeholder="Tell us about yourself..."></textarea>
                                        <small class="char-counter"><span id="about-char-count">0</span>/500 characters</small>
                                    </div>
                                </div>
                            </div>

                            <div class="profile-actions">
                                <button type="button" class="btn-secondary" onclick="cancelEditMode()">
                                    âŒ Cancel
                                </button>
                                <button type="submit" class="btn-primary">
                                    ğŸ’¾ Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </div>

</div>

<!-- Reflection Modal -->
<div id="reflection-modal" class="modal">
    <div class="modal-content">
        <h2>âœï¸ Reflection Time</h2>
        <p class="modal-subtitle">Before marking this habit as complete, take a moment to reflect on what you did.</p>
        
        <form id="reflection-form">
            <div class="form-group">
                <label for="reflection-input">What did you do?</label>
                <textarea 
                    id="reflection-input" 
                    rows="4"
                    placeholder="Describe what you accomplished... (minimum 5 characters)"
                    required
                ></textarea>
                <small class="char-count" id="reflection-char-count">0 characters</small>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeReflectionModal()">Cancel</button>
                <button type="submit" class="btn-primary">Complete Habit</button>
            </div>
        </form>
    </div>
</div>

<!-- Honesty Check Modal -->
<div id="honesty-modal" class="modal">
    <div class="modal-content">
        <h2>ğŸŒ™ End of Day Reflection</h2>
        <p class="modal-subtitle">Let's take a moment to honestly review today's habits. Your honesty helps you grow!</p>
        
        <div id="honesty-habits-list"></div>
        
        <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="skipHonestyCheck()">Skip for now</button>
            <button type="button" class="btn-primary" onclick="submitHonestyReview()">Submit Review</button>
        </div>
    </div>
</div>

<%- include('partials/footer') %>
